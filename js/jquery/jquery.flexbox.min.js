(function(a){a.flexbox=function(o,k){var s=false,n=[],ah=[],q=0,ai="\u25CA",p=false,ak=k.paging.pageSize,aj=a(o).css("position","relative").css("z-index",0);var l=a(document.createElement("input")).attr("type","hidden").attr("id",aj.attr("id")+"_hidden").attr("name",aj.attr("id")).val(k.initialValue).appendTo(aj);var ac=a(document.createElement("input")).attr("id",aj.attr("id")+"_input").addClass(k.inputClass).css("width",k.width+"px").appendTo(aj).click(function(b){if(k.watermark!==""&&this.value===k.watermark){this.value=""}else{this.select()}}).focus(function(b){a(this).removeClass("watermark")}).blur(function(b){setTimeout(function(){if(!ac.attr("active")){j()}},200)}).keypress(u);if(k.initialValue!==""){ac.val(k.initialValue).removeClass("watermark")}else{ac.val(k.watermark).addClass("watermark")}if(a.browser.msie){ac.keydown(u)}var an=0;if(k.showArrow&&k.showResults){var i=a(document.createElement("span")).attr("id",aj.attr("id")+"_arrow").addClass(k.arrowClass).addClass("out").hover(function(){a(this).removeClass("out").addClass("over")},function(){a(this).removeClass("over").addClass("out")}).mousedown(function(){a(this).removeClass("over").addClass("active")}).mouseup(function(){a(this).removeClass("active").addClass("over")}).click(function(b){if(aa.is(":visible")){j()}else{ac.focus();if(k.watermark!==""&&ac.val()===k.watermark){ac.val("")}else{ac.select()}if(s){clearTimeout(s)}s=setTimeout(function(){x(1,true,k.arrowQuery)},k.queryDelay)}}).appendTo(aj);an=i.outerWidth();ac.css("width",(k.width-i.width())+"px")}var aa=a(document.createElement("div")).attr("id",aj.attr("id")+"_ctr").css("width",(ac.outerWidth()+an-2)+"px").css("top",ac.outerHeight()).css("left",0).addClass(k.containerClass).appendTo(aj).hide();var A=a(document.createElement("div")).addClass(k.contentClass).appendTo(aa).scroll(function(){p=true});var r=a(document.createElement("div")).appendTo(aa);function u(b){var d=0;if(typeof(b.ctrlKey)!=="undefined"){if(b.ctrlKey){d|=1}if(b.shiftKey){d|=2}}else{if(b.modifiers&Event.CONTROL_MASK){d|=1}if(b.modifiers&Event.SHIFT_MASK){d|=2}}if(/16$|17$/.test(b.keyCode)){return}var c=b.keyCode===9;var e=b.keyCode===9&&d>0;if(c){if(v()){y()}}if((/27$|38$|39$|37$/.test(b.keyCode)&&aa.is(":visible"))||(/13$|40$/.test(b.keyCode))){if(b.preventDefault){b.preventDefault()}if(b.stopPropagation){b.stopPropagation()}b.cancelBubble=true;b.returnValue=false;switch(b.keyCode){case 38:w();break;case 40:if(aa.is(":visible")){al()}else{ae(true)}break;case 13:if(v()){y()}else{ae(true)}break;case 27:j();break;case 39:a("#"+aj.attr("id")+"n").click();break;case 37:a("#"+aj.attr("id")+"p").click();break}}else{if(!c&&!e){ae(false)}}}function ae(b){if(s){clearTimeout(s)}s=setTimeout(function(){x(1,b,"")},k.queryDelay)}function x(b,e,c){var d=c&&c.length>0?c:a.trim(ac.val());if(d.length>=k.minChars||e){A.html("").attr("scrollTop",0);var f=ag(d,b);if(f){z(f.data,d);af(b,f.t)}else{ak=ak===undefined?0:ak;var h={q:d,p:b,s:ak,contentType:"application/json; charset=utf-8"};var g=function(B){var C=z(B,d);totalResults=parseInt(B[k.totalProperty]);t(d,b,ak,totalResults,B,C);af(b,totalResults)};a.post(k.source,h,g,"json")}}else{j()}}function af(b,d){r.html("").removeClass(k.paging.cssClass);A.css("height","auto");if(k.showResults&&k.paging&&d>ak){var e=d/ak,c=d%ak;if(c>0){e=parseInt(++e)}ab(e,b,d)}}function ad(b,c,d){if(/^13$|^39$|^37$/.test(b.keyCode)){if(b.preventDefault){b.preventDefault()}if(b.stopPropagation){b.stopPropagation()}b.cancelBubble=true;b.returnValue=false;switch(b.keyCode){case 13:if(/^\d+$/.test(c)&&c<=d){x(c,true)}else{alert("Please enter a page number less than or equal to "+d)}break;case 39:a("#"+aj.attr("id")+"n").click();break;case 37:a("#"+aj.attr("id")+"p").click();break}}}function m(b){ac.attr("active",true);x(parseInt(a(this).attr("page")),true,ac.attr("pq"));return false}function ab(J,d,E){var H="&lt;&lt;",g="&lt;",f="&gt;",F="&gt;&gt;",I="...";r.addClass(k.paging.cssClass);var B=a(document.createElement("a")).attr("href","#").addClass("page").click(m),L=a(document.createElement("span")).addClass("page"),G=aj.attr("id");if(d>1){B.clone(true).attr("id",G+"f").attr("page",1).html(H).appendTo(r);B.clone(true).attr("id",G+"p").attr("page",d-1).html(g).appendTo(r)}else{L.clone(true).html(H).appendTo(r);L.clone(true).html(g).appendTo(r)}if(k.paging.style==="links"){var M=k.paging.maxPageLinks;if(J<=M){for(var c=1;c<=J;c++){if(c===d){L.clone(true).html(d).appendTo(r)}else{B.clone(true).attr("page",c).html(c).appendTo(r)}}}else{if((d+parseInt(M/2))>J){startPage=J-M+1}else{startPage=d-parseInt(M/2)}if(startPage>1){B.clone(true).attr("page",startPage-1).html(I).appendTo(r)}else{startPage=1}for(var c=startPage;c<startPage+M;c++){if(c===d){L.clone(true).html(c).appendTo(r)}else{B.clone(true).attr("page",c).html(c).appendTo(r)}}if(J>(startPage+M)){B.clone(true).attr("page",c).html(I).appendTo(r)}}}else{if(k.paging.style==="input"){var e=a(document.createElement("input")).addClass("box").click(function(N){ac.attr("active",true);this.select()}).keypress(function(N){return ad(N,this.value,J)}).val(d).appendTo(r)}}if(d<J){var K=B.clone(true).attr("id",G+"n").attr("page",+d+1).html(f).appendTo(r);B.clone(true).attr("id",G+"l").attr("page",J).html(F).appendTo(r);A.css("height",($row.outerHeight()*ak)+"px")}else{L.clone(true).html(f).appendTo(r);L.clone(true).html(F).appendTo(r);A.css("height","auto")}var C=(d-1)*ak+1;var h=(C>(E-ak))?E:C+ak-1;if(k.paging.showSummary){var b={start:C,end:h,total:E,page:d,pages:J};var D=k.paging.summaryTemplate.applyTemplate(b);a(document.createElement("span")).addClass(k.paging.summaryClass).html(D).appendTo(r)}}function ag(c,b){var d=c+ai+b;if(ah[d]){for(var e=0;e<n.length;e++){if(n[e]===d){n.unshift(n.splice(e,1)[0]);return ah[d]}}}return false}function t(h,g,b,d,B,e){if(k.maxCacheBytes>0){while(n.length&&(q+e>k.maxCacheBytes)){var c=n.pop();q-=c.size}var f=h+ai+g;ah[f]={q:h,p:g,s:b,t:d,size:e,data:B};n.push(f);q+=e}}function z(b,B){var G=0;if(!b){return}if(parseInt(b[k.totalProperty])===0&&k.noResultsText&&k.noResultsText.length>0){A.addClass(k.noResultsClass).html(k.noResultsText);aa.show();return}else{A.removeClass(k.noResultsClass)}for(var e=0;e<b[k.resultsProperty].length;e++){var g=b[k.resultsProperty][e],C=k.resultTemplate.applyTemplate(g),f=B===C,h=false,E=false;if(!f&&k.highlightMatches&&B!==""){var c=B,d='<span class="'+k.matchClass+'">'+B+"</span>";if(C.match("<(.|\n)*?>")){E=true;c="(>)([^<]*?)("+B+")((.|\n)*?)(<)";d='$1$2<span class="'+k.matchClass+'">$3</span>$4$6'}C=C.replace(new RegExp(c,k.highlightMatchesRegExModifier),d)}if(k.autoCompleteFirstMatch&&!E&&e===0){var D=g[k.displayValue];if(B.length>0&&D.indexOf(B)===0){ac.attr("pq",B);ac.val(D);h=am(B.length,ac.val().length)}}if(!k.showResults){return}$row=a(document.createElement("div")).attr("id",g[k.displayValue]).attr("val",g[k.hiddenValue]).addClass("row").html(C).click(function(H){ac.attr("active",true)}).appendTo(A);if((!k.paging||(k.paging&&ak>b[k.totalProperty]))&&e===b[k.resultsProperty].length-1){$row.css("border-bottom","none")}if(f||h){$row.addClass(k.selectClass)}G+=C.length}if(G===0){j();return}aa.parent().css("z-index",11000);aa.show();A.children("div").mouseover(function(){A.children("div").removeClass(k.selectClass);a(this).addClass(k.selectClass)}).click(function(H){H.preventDefault();H.stopPropagation();y()});if(k.maxVisibleRows>0){var F=Math.round($row.parent()[0].scrollHeight/b[k.totalProperty])*k.maxVisibleRows;A.css("maxHeight",F)}else{A.css("height","auto")}return G}function am(c,d){var e=ac[0];if(e.createTextRange){var b=e.createTextRange();b.moveStart("character",c);b.moveEnd("character",d-e.value.length);b.select()}else{if(e.setSelectionRange){e.setSelectionRange(c,d)}}e.focus();return true}String.prototype.applyTemplate=function(b){try{if(b===""){return this}return this.replace(/{([^{}]*)}/g,function(e,f){var h;if(f.indexOf(".")!==-1){var B=f.split(".");var g=b;for(var d=0;d<B.length;d++){g=g[B[d]]}h=g}else{h=b[f]}if(typeof h==="string"||typeof h==="number"){return h}else{throw (e)}})}catch(c){alert("Invalid JSON property "+c+" found when trying to apply resultTemplate or paging.summaryTemplate.\nPlease check your spelling and try again.")}};function j(){ac.attr("active",false);aj.css("z-index",0);aa.hide()}function v(){if(!aa.is(":visible")){return false}var b=A.children("div."+k.selectClass);if(!b.length){b=false}return b}function y(){$curr=v();if($curr){ac.val($curr.attr("id")).focus();l.val($curr.attr("val"));j();if(k.onSelect){ac.attr("hiddenValue",l.val());k.onSelect.apply(ac[0])}}}function al(){$curr=v();if($curr&&$curr.next().length>0){$curr.removeClass(k.selectClass).next().addClass(k.selectClass);var g=A.attr("scrollTop"),b=$curr[0],c,e,f;if(a.browser.mozilla&&parseInt(a.browser.version)<=2){c=document.getBoxObjectFor(A[0]).y+A.attr("offsetHeight");e=document.getBoxObjectFor(b).y+$curr.attr("offsetHeight");f=document.getBoxObjectFor(b).height}else{c=A[0].getBoundingClientRect().bottom;var d=b.getBoundingClientRect();e=d.bottom;f=e-d.top}if(e>=c){A.attr("scrollTop",g+f)}}else{if(!$curr){A.children("div:first-child").addClass(k.selectClass)}}}function w(){$curr=v();if($curr&&$curr.prev().length>0){$curr.removeClass(k.selectClass).prev().addClass(k.selectClass);var g=A.attr("scrollTop"),h=$curr[0],e=$curr.parent()[0],c,b,f;if(a.browser.mozilla&&parseInt(a.browser.version)<=2){f=document.getBoxObjectFor(h).height;c=document.getBoxObjectFor(A[0]).y-(f*2);b=document.getBoxObjectFor(h).y-document.getBoxObjectFor(A[0]).y}else{c=e.getBoundingClientRect().top;var d=h.getBoundingClientRect();b=d.top;f=d.bottom-b}if(b<=c){A.attr("scrollTop",g-f)}}else{if(!$curr){A.children("div:last-child").addClass(k.selectClass)}}}};a.fn.flexbox=function(e,g){if(!e){return}try{var d=a.fn.flexbox.defaults;var c=a.extend({},d,g);for(var b in c){if(d[b]===undefined){throw ("Invalid option specified: "+b+"\nPlease check your spelling and try again.")}}c.source=e;if(g){c.paging=(g.paging||g.paging==null)?a.extend({},d.paging,g.paging):false;for(var b in c.paging){if(d.paging[b]===undefined){throw ("Invalid option specified: "+b+"\nPlease check your spelling and try again.")}}if(g.displayValue&&!g.hiddenValue){c.hiddenValue=g.displayValue}}this.each(function(){new a.flexbox(this,c)});return this}catch(f){if(typeof f==="object"){alert(f.message)}else{alert(f)}}};a.fn.flexbox.defaults={queryDelay:200,containerClass:"ffb",contentClass:"content",selectClass:"ffb-sel",inputClass:"ffb-input",arrowClass:"ffb-arrow",matchClass:"ffb-match",noResultsText:"No matching results",noResultsClass:"ffb-no-results",showResults:true,autoCompleteFirstMatch:true,highlightMatches:true,highlightMatchesRegExModifier:"i",minChars:1,showArrow:true,arrowQuery:"",onSelect:false,maxCacheBytes:32768,resultTemplate:"{name}",displayValue:"name",hiddenValue:"id",initialValue:"",watermark:"",width:200,resultsProperty:"results",totalProperty:"total",maxVisibleRows:0,paging:{style:"input",cssClass:"paging",pageSize:10,maxPageLinks:5,showSummary:true,summaryClass:"summary",summaryTemplate:"Displaying {start}-{end} of {total} results"}};a.fn.setValue=function(c){var b="#"+this.attr("id");a(b+"_hidden,"+b+"_input").val(c).removeClass("watermark")}})(jQuery);
