var error=null;var msg=null;var current_page=1;var per_page=10;var sort_by="by_date";var sort_how="desc";function after_panel_loaded(){try{$("#msg_value").html(msg);$("#msg_panel").show()}catch(a){_sys_error("after_panel_loaded","Show message after updating news",a)}}function load_news_list(b){try{$.each(b,function(d,e){if(d=="ppage"&&!isNaN(e)){per_page=e}else{if(d=="cpage"){current_page=(e>0)?e:1}else{if(d=="ord"){sort_by=e;sort_how=(sort_how=="asc")?"desc":"asc"}}}return});var c={cpage:current_page,ppage:per_page,ord:sort_by,ord_type:sort_how}}catch(a){_sys_error("load_news_list","Generates news list",a)}load_panel(base_url+"config/site_news",c)}function after_delete_news_success(c){try{var b={cpage:current_page,ppage:per_page,ord:sort_by,ord_type:sort_how}}catch(a){_sys_error("after_delete_news_success","Loading list news after delete",a)}load_panel(base_url+"config/site_news",b)}function after_delete_news_error(a){try{if(a!=""){$("#error_msg").html(""+a)}var c={cpage:current_page,ppage:per_page,ord:sort_by,ord_type:sort_how}}catch(b){_sys_error("after_delete_news_success","Loading list news after delete",b)}load_panel(base_url+"config/site_news",c)}function delete_news(b){if(parseInt(b)>0){var a=$("#delete_question").text();if(confirm(a+"?")){on_post_success=after_delete_news_success;on_post_error=after_delete_news_error;load_panel(base_url+"config/site_news_del/"+b)}}else{$("#error_msg").html("ID is wrong")}}function after_add_news_success(c){msg=c;after_panel_load=after_panel_loaded;try{var b={cpage:current_page,ppage:per_page,ord:sort_by,ord_type:sort_how}}catch(a){_sys_error("after_add_news_success","Getting pager params",a)}load_panel(base_url+"config/site_news",b)}function after_add_news_error(a){if(a!=""){$("#error_value").html(""+a);$("#error_panel").show()}}function add_news(){try{var c=$("#date1Entry").val();var h=$("#news_header").val();var f=$("#news_brief").val();var a=$("#news_content").val();var b="0";if($("#members_only").attr("checked")==true){var b="1"}}catch(d){_sys_error("add_news","Getting fields values",d)}var g={date:c,header:h,brief:f,content:a,members_only:b,action:"add"};if(validate_fields(g)){on_post_success=after_add_news_success;on_post_error=after_add_news_error;load_panel(base_url+"config/site_news_add",g)}}function after_edit_news_success(c){msg=c;after_panel_load=after_panel_loaded;try{var b={cpage:current_page,ppage:per_page,ord:sort_by,ord_type:sort_how}}catch(a){_sys_error("after_edit_news_success","Getting pager params",a)}load_panel(base_url+"config/site_news",b)}function after_edit_news_error(a){if(a!=""){try{$("#error_value").html(""+a);$("#error_panel").show()}catch(b){_sys_error("after_edit_news_error","Show error after edit news",b)}}}function edit_news(i){try{var c=$("#date1Entry").val();var h=$("#news_header").val();var f=$("#news_brief").val();var a=$("#news_content").val();var b="0";if($("#members_only").attr("checked")==true){var b="1"}}catch(d){_sys_error("edit_news","Getting values from fields",d)}var g={date:c,header:h,brief:f,content:a,members_only:b,action:"edit"};if(validate_fields(g)){on_post_success=after_edit_news_success;on_post_error=after_edit_news_error;load_panel(base_url+"config/site_news_edit/"+i,g)}}function req_load_edit_news_error(a){try{$("#error_msg").html(""+a)}catch(b){_sys_error("req_load_edit_news_error","Show error for edit news",b)}}function req_load_edit_news_form(a){on_post_error=req_load_edit_news_error;load_panel(base_url+"config/site_news_edit/"+a)}function validate_fields(b){var c=true;try{$("div#error_panel").children(".box_err").hide();$.each(b,function(d,e){if(e==""){$("#jsvalid_error_fields_empty").show();$("#error_panel").show();c=false;return}else{if(d=="date"&&!check_date(e)){$("#jsvalid_error_date_wrong").show();$("#error_panel").show();c=false;return}else{if(d=="header"&&!check_max_len(e,50)){$("#jsvalid_error_header_toolong").show();$("#error_panel").show();c=false;return}else{if(d=="brief"&&!check_max_len(e,300)){$("#jsvalid_error_brief_toolong").show();$("#error_panel").show();c=false;return}else{if(d=="content"&&!check_max_len(e,5000)){$("#jsvalid_error_content_toolong").show();$("#error_panel").show();c=false;return}else{if(d=="members_only"&&e!="0"&&e!="1"){$("#jsvalid_error_members_only_wrong").show();$("#error_panel").show();c=false;return}}}}}}})}catch(a){_sys_error("validate_fields","Checking form fields",a)}return c};
