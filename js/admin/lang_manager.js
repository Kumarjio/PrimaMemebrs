var validator;var selector;var last_focus="descr";var cur_teplate_lang;function myPanelOnLoad(){try{validator=new FormValidator();selector=new multiSelector();cur_teplate_lang=$("#langs").val();validator.add("langs");if($("#name").length>0){var a="val.length<="+temp_vars_set.name_max+" && val.length>="+temp_vars_set.name_min;validator.add("name",a);$("#name").bind("blur",function(){last_focus="name"});validator.items.name.checkOnEvent("keyup")}if($("#descr").length>0){var a="val.length<="+temp_vars_set.descr_max+" && val.length>="+temp_vars_set.descr_min;validator.add("descr",a);validator.items.descr.checkOnEvent("keyup");$("#descr").bind("blur",function(){last_focus="descr"})}if($("#add").length>0){var a="val.length<="+temp_vars_set.add_max+" && val.length>="+temp_vars_set.add_min;validator.add("add",a);$("#add").bind("blur",function(){last_focus="add"});validator.items.add.checkOnEvent("keyup")}validator.checkAll()}catch(b){alert("myTabOnLoad: "+b.message);_sys_error("Error:","FAIL",b)}}function myPanelDestructor(){validator=null;selector=null}function myOnSave(h,c){try{errorBoxControl();var d=base_url+"lang_manager/";if(c){if(!validator.isChanged()||confirm(temp_vars_set.cancelText)){if(temp_vars_set.referer&&temp_vars_set.referer!="undefined"){redirectAndMessage(temp_vars_set.referer)}else{reloadLang()}}}else{displayMessageEx();if(!validator.checkAll()||!validator.isChanged()){var b=(!validator.isChanged())?"not_saved":"validation_fail";displayMessageEx(b,true);validator.setOnCheck(errorBoxControl)}else{var g={action:"save"};g.id=temp_vars_set.id;g.object_type=temp_vars_set.object_type;g.referer=temp_vars_set.referer;var a=validator.getItems();for(key in a){if(typeof(a[key])!="function"){g[key]=a[key]}}g.language_id=g.langs;delete (g.langs);on_post_error=save_error;on_post_message=after_message_load;load_message(d+"edit/",g)}}}catch(f){alert("lang_manager_save: "+f);_sys_error("Error:","FAIL",f)}}function reloadLang(){if(validator.isChanged(new Array("name","descr","add"))&&!confirm(temp_vars_set.cancelText)){validator.items.langs.setValue(cur_teplate_lang);return}var a={action:"",type:"config"};a.id=temp_vars_set.id;a.template_name=temp_vars_set.template_name;a.object_type=temp_vars_set.object_type;a.referer=temp_vars_set.referer;a.language_id=$("#langs").val();load_panel(base_url+"lang_manager/edit/",a,{"0":base_url+"js/admin/init.js"})}function exportDlg(){$("#from_langs_tr").toggle()}function importLang(){if(validator.isChanged(new Array("name","descr","add"))&&!confirm(temp_vars_set.cancelText)){validator.items.langs.setValue(cur_teplate_lang);return}on_post_message=after_message_load;var a={action:"import"};a.id=temp_vars_set.id;a.object_type=temp_vars_set.object_type;a.language_id=($("#from_langs").length>0)?$("#from_langs").val():"-1";load_message(base_url+"lang_manager/import",a)}function myOnAdd(){if(isset(temp_vars_set["constants_"+last_focus])){insertAtCaret($("#"+last_focus).get(0),$("#constants").val());validator.items.name.check();if($("#descr").length>0){validator.items.descr.check()}}}function after_message_load(b){var a=getTempVarsSet(false,b);if(a.action=="import"){if($("#name").length>0){validator.items.name.setValue(Base64.decode(a.name))}if($("#descr").length>0){validator.items.descr.setValue(Base64.decode(a.descr))}if($("#add").length>0){validator.items.add.setValue(Base64.decode(a.add))}validator.checkAll()}if(a.action=="save"){if(temp_vars_set.referer&&temp_vars_set.referer!="undefined"){redirectAndMessage(temp_vars_set.referer,a.mess)}else{displayMessageEx(a.mess)}}}function after_save(b){var a=getTempVarsSet(false,b);displayMessageEx(a);window.tempTimer=setInterval("clearInterval(window.tempTimer);;document.location.hash='#'+temp_vars_set['referer'];window.location.hashCheck();",2000)}function save_error(b){var a=getTempVarsSet(false,b);displayMessageEx(a,true);validator.setOnCheck(errorBoxControl)}function errorBoxControl(){try{var b=false;for(key in validator.items){if(typeof(validator.items[key])!="function"){b=validator.items[key].error.is_error?true:b}}if(!b){displayMessageEx(false,true);validator.setOnCheck()}}catch(a){alert("errorBoxControl: "+a.message)}};
