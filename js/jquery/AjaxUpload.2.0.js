(function(){var i=document,m=window;var c=false;function f(d){if(typeof d=="string"){d=i.getElementById(d)}return d}function e(r,q,d){if(m.addEventListener){r.addEventListener(q,d,false)}else{if(m.attachEvent){var s=function(){d.call(r,m.event)};r.attachEvent("on"+q,s)}}}var b=function(){var d=i.createElement("div");return function(q){d.innerHTML=q;var r=d.childNodes[0];d.removeChild(r);return r}}();function g(q,d){return q.className.match(new RegExp("(\\s|^)"+d+"(\\s|$)"))}function h(q,d){if(!g(q,d)){q.className+=" "+d}}function n(r,d){var q=new RegExp("(\\s|^)"+d+"(\\s|$)");r.className=r.className.replace(q," ")}function o(d){if(false&&m.jQuery){var s=jQuery(d).offset();s.top=c?jQuery(document).scrollTop()+s.top:s.top;return s}var r=0,q=0;do{r+=d.offsetTop||0;q+=d.offsetLeft||0}while(d=d.offsetParent);if(m.jQuery){if(jQuery.browser.safari){q-=460;r-=114}r=c?jQuery(document).scrollTop()+r:r}return{left:q,top:r}}function a(r){var t,q,s,d;var u=o(r);t=u.left;s=u.top;q=t+r.offsetWidth;d=s+r.offsetHeight;return{left:t,right:q,top:s,bottom:d}}function k(d){if(!d.pageX&&d.clientX){return{x:d.clientX+i.body.scrollLeft+i.documentElement.scrollLeft,y:d.clientY+i.body.scrollTop+i.documentElement.scrollTop}}return{x:d.pageX,y:d.pageY}}var j=function(){var d=0;return function(){return"ValumsAjaxUpload"+d++}}();function p(d){return d.replace(/.*(\/|\\)/,"")}function l(d){return(/[.]/.exec(d))?/[^.]+$/.exec(d.toLowerCase()):""}(function(){var d=null;Ajax_upload=AjaxUpload=function(s,q){if(s.jquery){s=s[0]}else{if(typeof s=="string"&&/^#.*/.test(s)){s=s.slice(1)}}s=f(s);this._input=null;this._button=s;this._disabled=false;this._submitting=false;this._settings={action:"upload.php",name:"userfile",data:{},autoSubmit:true,onChange:function(t,u){},onSubmit:function(t,u){},onComplete:function(u,t){},positionFixed:false};for(var r in q){this._settings[r]=q[r]}c=this._settings.positionFixed;this._createInput();this._rerouteClicks();if(!d){this._createIframe()}};AjaxUpload.prototype={setData:function(q){this._settings.data=q},disable:function(){this._disabled=true},enable:function(){this._disabled=false},set_data:function(q){this.setData(q)},_createInput:function(){var r=this;var q=i.createElement("input");q.setAttribute("type","file");q.setAttribute("name",this._settings.name);var t={position:"absolute",margin:"-5px 0 0 -175px",padding:0,width:"220px",height:"10px",opacity:0,cursor:"pointer",display:"none"};for(var s in t){q.style[s]=t[s]}if(!(q.style.opacity==="0")){q.style.filter="alpha(opacity=0)"}i.body.appendChild(q);e(q,"change",function(){var u=p(this.value);if(r._settings.onChange.call(r,u,l(u))==false){return}if(r._settings.autoSubmit){r.submit()}});this._input=q},_rerouteClicks:function(){var q=this;var r,s=false;e(q._button,"mouseover",function(t){if(!q._input||s){return}s=true;r=a(q._button)});e(document,"mousemove",function(u){var t=q._input;if(!t||!s){return}if(q._disabled){n(q._button,"hover");t.style.display="none";return}var v=k(u);if((v.x>=r.left)&&(v.x<=r.right)&&(v.y>=r.top)&&(v.y<=r.bottom)){t.style.top=v.y+"px";t.style.left=v.x+"px";t.style.display="block";h(q._button,"hover")}else{s=false;t.style.display="none";n(q._button,"hover")}})},_createIframe:function(){var q=j();_iframe=b('<iframe name="'+q+'" />');_iframe.id=q;_iframe.style.display="none";i.body.appendChild(_iframe)},submit:function(){var q=this,t=this._settings;if(this._input.value===""){return}var r=p(this._input.value);if(!(t.onSubmit.call(this,r,l(r))==false)){var u=this._createForm();u.appendChild(this._input);u.submit();i.body.removeChild(u);u=null;this._input=null;this._createInput();var s=_iframe;e(s,"load",function(){var w=false;if(s.src=="about:blank"){if(w){s.remove()}return}var x=s.contentDocument?s.contentDocument:frames[s.id].document;var v=x.body.innerHTML;t.onComplete.call(q,r,v);s.src="about:blank";w=true});this._createIframe()}else{this._input.value=""}},_createForm:function(){var r=this._settings;var s=b('<form method="post" enctype="multipart/form-data"></form>');s.style.display="none";s.action=r.action;s.target=_iframe.name;i.body.appendChild(s);for(var t in r.data){var q=i.createElement("input");q.type="hidden";q.name=t;q.value=r.data[t];s.appendChild(q)}return s}}})()})();
