var validator;var selector;function myPanelOnLoad(){try{validator=new FormValidator();selector=new multiSelector();temp_vars_set=getTempVarsSet(temp_vars_set);validator.add("site_name","check_max_len(val, 254)&&val");validator.items.site_name.checkOnEvent("keyup");validator.add("base_url","check_url(val)&&check_max_len(val, 254)&&val");validator.items.base_url.checkOnEvent("keyup");validator.add("absolute_path","check_max_len(val, 254)&&val");validator.items.absolute_path.checkOnEvent("keyup");validator.items.absolute_path.checkOnEvent("blur",is_path_exist);validator.add("logout_redirect","(check_url(val)&&check_max_len(val, 254))||!val");validator.items.logout_redirect.checkOnEvent("keyup");validator.add("login_redirect","(check_url(val)&&check_max_len(val, 254))||!val");validator.items.login_redirect.checkOnEvent("keyup");validator.add("personal_login_redirect_flag");validator.add("login_page","(check_url(val)&&check_max_len(val, 254))||!val");validator.items.login_page.checkOnEvent("keyup");validator.add("perpage_list","val<100");validator.items.perpage_list.checkOnEvent("change");validator.add("site_ip","check_ip(val)&&val");validator.items.site_ip.checkOnEvent("keyup");validator.add("date_format","check_date_format(val)&&val");validator.items.date_format.checkOnEvent("keyup");validator.add("log_members");validator.add("log_admins");validator.add("history_kept","check_int_limit(val,365,0)");validator.items.history_kept.checkOnEvent("keyup");validator.add("ext_text","(check_extention(val)&&check_max_len(val, 10))||!val");validator.items.ext_text.checkOnEvent("keyup");validator.checkAll()}catch(a){alert("myTabOnLoad: "+a.message);_sys_error("Error:","FAIL",a)}}function myPanelDestructor(){validator=null;selector=null}function is_path_exist(c,d,b,a){var e={action:""};e[c]=d;on_post_message=path_exist_success;load_message(base_url+"config/global_setup_path_exist/",e)}function path_exist_success(c){try{var a;a=getTempVarsSet(a,c);for(key in a){if((typeof(a[key])!="function")&&isset(validator)&&validator!=null&&isset(validator.items)&&isset(validator.items[key])&&validator.items[key].value==Base64.decode(a[key]["path"])&&!a[key]["is_exist"]){validator.items[key].showError(a[key]["error_text"]);validator.items[key].error.is_error=true}}return true}catch(b){alert(b.message)}}function after_save(b){var a=getTempVarsSet(false,b);if(isset(a.date_format)&&check_date_format(a.date_format)){window.date_format=a.date_format}if(isset(a.last_login)){$("#user_info_last_login").html(a.last_login)}delete (a.date_format);delete (a.last_login);displayMessageEx(a)}function save_error(b){var a=getTempVarsSet(false,b);displayMessageEx(a,true)}function errorBoxControl(){try{var b=false;for(key in validator.items){if(typeof(validator.items[key])!="function"){b=validator.items[key].error.is_error?true:b}}if(!b){displayMessageEx(false,true);validator.setOnCheck()}}catch(a){alert("errorBoxControl: "+a.message)}}function addExt(){validator.items.ext_text.rule="(check_extention(val)&&check_max_len(val, 10))";if(validator.items.ext_text.check()){selector.add("ignorsel","ext_text")}validator.items.ext_text.rule="(check_extention(val)&&check_max_len(val, 10))||!val"}function global_save(c,b){try{if(b){if(confirm(temp_vars_set.cancelText)){var f={action:""};load_panel(c,f,{"0":base_url+"js/admin/init.js"})}}else{displayMessageEx();validator.items.ext_text.error.validation=false;if(validator.items.absolute_path.error.is_error||!validator.checkAll()){validator.items.ext_text.error.validation=true;displayMessageEx("validation_fail",true);validator.setOnCheck(errorBoxControl)}else{if(validator.items.base_url.isChanged()&&!confirm(temp_vars_set.warningChangeUrl)){return false}if(validator.items.absolute_path.isChanged()&&!confirm(temp_vars_set.warningChangePath)){return false}var f={action:"save"};var a=validator.getItems();a.default_perpage=a.perpage_list;delete (a.perpage_list);delete (a.ext_text);a.ignored_extensions=selector.getAllItems("ignorsel",",");for(key in a){if(typeof(a[key])!="function"){f[key]=a[key]}}on_post_error=save_error;additional_accept=after_save;load_panel(c,f,{"0":base_url+"js/admin/init.js"})}}}catch(d){alert("global_save: "+d.message);_sys_error("Error:","FAIL",d)}};
