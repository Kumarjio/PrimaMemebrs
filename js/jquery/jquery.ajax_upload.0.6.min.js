(function(c){if(!c){return}c.ajax_upload=function(e,d){e=c(e);if(e.size()!=1){return false}return new a(e,d)};var b=function(){var d=0;return function(){return d++}}();var a=function(e,d){this.button=e;this.wrapper=null;this.form=null;this.input=null;this.iframe=null;this.disabled=false;this.submitting=false;this.settings={action:"upload.php",name:"userfile",data:{},onSubmit:function(f,g){},onComplete:function(g,f){},onSuccess:function(f){},onError:function(g,f){}};c.extend(this.settings,d);this.create_wrapper();this.create_input();if(jQuery.browser.msie){this.make_parent_opaque()}this.create_iframe()};a.prototype={set_data:function(d){this.settings.data=d},disable:function(){this.disabled=true;if(!this.submitting){this.input.attr("disabled",true)}},enable:function(){this.disabled=false;this.input.attr("disabled",false)},create_wrapper:function(){var e=this.button,f;f=this.wrapper=c("<div></div>").insertAfter(e).append(e);setTimeout(function(){f.css({position:"relative",display:"block",overflow:"hidden",height:e.outerHeight(true),width:e.outerWidth(true)})},1);var d=this;f.mousemove(function(g){if(!d.input){return}d.input.css({top:g.pageY-f.offset().top-5+"px",left:g.pageX-f.offset().left-170+"px"})})},create_input:function(){var d=this;this.input=c('<input type="file" />').attr("name",this.settings.name).css({position:"absolute",margin:0,padding:0,width:"220px",heigth:"10px",opacity:0}).change(function(){if(c(this).val()==""){return}d.submitting=true;d.submit();d.submitting=false}).appendTo(this.wrapper).hover(function(){d.button.addClass("hover")},function(){d.button.removeClass("hover")});if(this.disabled){this.input.attr("disabled",true)}},create_iframe:function(){var d="iframe_au"+b();this.iframe=c('<iframe name="'+d+'"></iframe>').css("display","none").appendTo("body")},submit:function(){var d=this,g=this.settings;var e=this.file_from_path(this.input.val());if(g.onSubmit.call(this,e,this.get_ext(e))===false){if(d.disabled){this.input.attr("disabled",true)}return}this.create_form();this.input.appendTo(this.form);this.form.submit();this.input.remove();this.input=null;this.form.remove();this.form=null;this.submitting=false;this.create_input();var f=this.iframe;f.load(function(){var h=f.contents().find("body").html();g.onComplete.call(d,e,h);if(h=="success"){g.onSuccess.call(d,e)}else{g.onError.call(d,e,h)}setTimeout(function(){f.remove()},1)});this.create_iframe()},create_form:function(){this.form=c('<form method="post" enctype="multipart/form-data"></form>').appendTo("body").attr({action:this.settings.action,target:this.iframe.attr("name")});for(var d in this.settings.data){c('<input type="hidden" />').appendTo(this.form).attr({name:d,value:this.settings.data[d]})}},file_from_path:function(e){var d=e.lastIndexOf("\\");if(d!==-1){return e.slice(d+1)}return e},get_ext:function(e){var d=e.lastIndexOf(".");if(d!==-1){return e.slice(d+1)}return""},make_parent_opaque:function(){this.button.add(this.button.parents()).each(function(){var d=c(this).css("backgroundColor");var e=c(this).css("backgroundImage");if(d!="transparent"||e!="none"){c(this).css("opacity",1);return false}})}}})(jQuery);
