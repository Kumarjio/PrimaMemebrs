var is_payment_added=false;function change_price_selector(b){try{var d="";d=$("#product_type").val();if(d!=""){$("#button").attr("disabled","")}else{$("#button").attr("disabled","true")}var f=0;var a=0;if(d!=0){f=d.split("-");$("#product").val(f[0])}$("select[id^='period-']").hide();$("#period-"+f[0]).show();if(f[1]==2){$("#type_1").hide();$("#type_2").show()}else{$("#type_2").hide();$("#type_1").show()}}catch(c){_sys_error("payments:change_price_selector","Changes period selectbox options according a product id",c)}}function after_load_payments_success(b){try{_change_accnt_panel_tab("tab_payments");$("#account_panel").html(b);if(is_payment_added){is_payment_added=false;_error_panel_hide();$("#jsaction_msg_add_invoice_success").show();$("#msg_panel").show()}}catch(a){_sys_error("payments:after_load_payments_success","Shows member's payments and subcriptions list",a)}}function load_payments(c){try{var a=$("#mbr_id").val();if(a>0){if(c){$.each(c,function(e,f){if(e=="ppage"&&!isNaN(f)){per_page=f;current_page=1}else{if(e=="cpage"){current_page=(f>0)?f:1}else{if(e=="ord"){sort_by=f;sort_how=(sort_how=="asc")?"desc":"asc"}}}return})}var d={user_id:a,cpage:current_page,ppage:per_page,ord:sort_by,ord_type:sort_how};on_post_success=after_load_payments_success;load_panel(base_url+"member/edit_member_payment",d)}}catch(b){_sys_error("payments:load_payments","Prepares params for member's payments and subscriptions list",b)}}function show_payment_form(b){try{if(b==1){_msg_panel_hide();_error_panel_hide();$("#sub_error_member_expired").show();$("#sub_error_panel").show()}else{$("#show_hide_add_invoice_div").toggle()}}catch(a){_sys_error("payments:show_payment_form","Shows member's payment form",a)}}function after_add_payment_success(b){try{is_payment_added=true;load_payments();return 1}catch(a){_sys_error("payments:after_add_payment_success","Shows a message about successful invoice adding",a)}}function after_add_payment_error(a){_msg_panel_hide();if(a!=""){_error_panel_show(a)}}function add_payment(){try{_msg_panel_hide();_error_panel_hide();var c=$("#mbr_id").val();if(c>0){var b=$("#product").val();var a=$("#product_type").val();var i=$("#period-"+b).val();var f=$("#payment_system").val();var d=$("#transaction").val();var h={uid:c,product:b,product_type:a,period:i,payment_system:f,transaction:d,action:"add"};if(_validate_payment_fields(h)){on_post_success=after_add_payment_success;on_post_error=after_add_payment_error;load_panel(base_url+"member/edit_member_payment_add",h);return false}return}}catch(g){_sys_error("payments:add_payment","Adds a payment and subscription to the member",g)}}function _validate_payment_fields(b){var c=true;try{$("div#error_panel").children(".box_err").hide();$.each(b,function(e,g){if(e=="uid"){if(g<1){$("#jsvalid_error_member_id_wrong").show();$("#error_panel").show();c=false;return}}else{if(e=="product"){if(g<1){$("#jsvalid_error_product_id_wrong").show();$("#error_panel").show();c=false;return}}else{if(e=="period"){if(g==""){$("#jsvalid_error_period_empty").show();$("#error_panel").show();c=false;return}}}}if(e=="payment_system"){var d=(isset(b.period)&&b.period=="unlimit-0")?true:false;if(g<1&&!d){$("#jsvalid_error_payment_system_wrong").show();$("#error_panel").show();c=false;return}}else{if(e=="transaction"){var f=$("#product_type").val();if(f!=0){id=f.split("-")}if(id[1]==1){if(g==""){$("#jsvalid_error_transaction_empty").show();$("#error_panel").show();c=false;return}if(!check_max_len(g,32)){$("#jsvalid_error_transaction_toolong").show();$("#error_panel").show();c=false;return}}else{if(g==""){$("#jsvalid_error_domain_name_empty").show();$("#error_panel").show();c=false;return}if(!check_max_len(g,64)){$("#jsvalid_error_domain_name_toolong").show();$("#error_panel").show();c=false;return}}}}})}catch(a){_sys_error("payments:validate_payment_fields","Validate payment  params",a)}return c};
