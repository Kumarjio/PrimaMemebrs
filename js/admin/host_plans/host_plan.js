var javascripts={"0":base_url+"js/admin/init.js"};var validator;var form_fields=new Array("id","name","type_domen","packages");var form_initials=new Array();function treeview_control_is_disabled(){return($.browser.msie&&(parseInt($.browser.version)<7))}function hide_absolutely_all_errors(){displayMessageEx(false,true,false);displayMessageEx(false,false,false)}function myPagerHandler(a){load_panel(base_url+"host_plans/host_plans_list",a,javascripts)}function delete_host_plan(d,c){if((isset(c)&&c===true)||confirm("Please confirm host_plan removal")){try{var b=getPagerParams();if(isset(c)&&c===true){b.confirmed=1}b.action="delete";b.id=d;on_post_error=host_plan_response_error;hide_absolutely_all_errors();load_panel(base_url+"host_plans/host_plans_list",b,javascripts)}catch(a){alert("delete_host_plan: "+a.message)}}}function reprotect_host_plan(c){try{var b=getPagerParams();b.action="reprotect";b.id=c;on_post_error=host_plan_response_error;hide_absolutely_all_errors();load_panel(base_url+"host_plans/host_plans_list",b,javascripts)}catch(a){alert("reprotect_host_plan: "+a.message)}}var all_host_plans=new Array();var all_host_plans_count=0;var left_host_plans_count=0;var not_reprotected_host_plans=new Array();function reprotect_all(){all_host_plans=new Array();all_host_plans_count=0;not_reprotected_host_plans=new Array();$.post(base_url+"host_plans/all_host_plans_id",{period:$("#reprotect_period").val()},function(b){var a=getTempVarsSet(false,b);for(key in a){all_host_plans[key]=a[key]}all_host_plans_count=all_host_plans.length;left_host_plans_count=all_host_plans_count;$("#reprotect_progress").html(temp_vars_set.reprotect_begin);reprotect()})}function reprotect(){if(left_host_plans_count<=0){$("#reprotect_progress").html(temp_vars_set.reprotect_end+"("+(all_host_plans_count-not_reprotected_host_plans.length)+"/"+all_host_plans_count+")");return}for(key in all_host_plans){if(typeof(all_host_plans[key])!="function"){$.post(base_url+"host_plans/reprotect",{number:key,id:all_host_plans[key]},function(c){var a=getTempVarsSet(false,c);if(a.result=="true"){var e=$("#host_plan_list tr td:first-child:contains("+a.id+")");if(e.length>0){var b=e.parent("tr");if(b.hasClass("light")){b.removeClass("light");b.addClass("dark")}else{b.removeClass("dark");b.addClass("light")}}}else{not_reprotected_host_plans[a.number]=a.id}delete (all_host_plans[a.number]);left_host_plans_count--;var d=all_host_plans_count-left_host_plans_count;$("#reprotect_progress").html(temp_vars_set.reprotect_progress+"("+d+"/"+all_host_plans_count+")");reprotect()});break}}}function edit_host_plan(c){try{document.location.hash=document.location.hash+"/"+c+"/host_plan_edit";var b=getPagerParams();b.id=c;on_post_error=host_plan_response_error;hide_absolutely_all_errors();load_panel(base_url+"host_plans/host_plan_item",b,javascripts)}catch(a){alert("edit_host_plan: "+a.message)}}function add_host_plan(){on_post_message=panel_after_save;on_post_error=host_plan_response_error;document.location.hash=document.location.hash+"/host_plan_add";load_panel(base_url+"host_plans/host_plan_item",getPagerParams(),javascripts)}function treeview_host_plan_has_subs(a){return(a&1)}function treeview_host_plan_is_protected(a){return(a&2)}function treeview_host_plan_loaded(a){return(a&4)}function treeview_host_plan_is_current(a){return(a&8)}function treeview_host_plan_is_protectable(a){return(a&16)}function treeview_load_host_plans(a){try{if(!file_system[a].path){return}if((!treeview_host_plan_loaded(file_system[a].value)&&treeview_host_plan_has_subs(file_system[a].value))){on_post_message=treeview_response_success;on_post_error=treeview_response_error;start_request(base_url+"host_plans/treeview",{path:file_system[a].path})}}catch(b){alert("treeview_load_host_plans: "+b.message);_sys_error("Error:","failed to load host_plans",b)}}function base64_array_decode(c){try{var a=new Array();for(key in c){if(typeof(c[key])!="function"){a[Base64.decode(key)]=Base64.decode(c[key])}}return a}catch(b){alert("base64_array_decode: "+b.message)}}function get_host_plan_id_by_path(b){for(var a=0;a<file_system.length;a++){if(file_system[a].path==b){return a}}return -1}function get_host_plan_parent_id(a){if(a=="/"){return -1}x=a.split("/");x.pop();x.pop();return get_host_plan_id_by_path(x.join("/")+"/")}function get_name_from_path(b){try{if(b=="/"){return"/"}x=b.split("/");return x[x.length-2]}catch(a){alert("get_name_from_path: "+a.message)}return""}function treeview_response_success(b){try{var a=base64_array_decode(getTempVarsSet(false,b));var f=new Array();for(path in a){if(typeof(a[path])!="function"){var d=parseInt(a[path]);var h=get_host_plan_id_by_path(path);var c=get_host_plan_parent_id(path);if(h==-1){file_system.push({path:path,value:d,parent:c});if(treeview_host_plan_loaded(d)){f.push(get_host_plan_id_by_path(path))}}else{if(!treeview_host_plan_loaded(file_system[h].value)&&treeview_host_plan_loaded(d)){f.push(h)}file_system[h].value=d}}}treeview_new_items(f)}catch(g){alert("treeview_response_success: "+g.message);_sys_error("Error:","Failed to get new items for treeview",g)}}function treeview_new_items(d,k){try{if(d.length>0){for(var a=0;a<d.length;a++){var c=d[a];var h="";for(var b=0;b<file_system.length;b++){if(file_system[b].parent==c){var f=(treeview_host_plan_has_subs(file_system[b].value))?"<ul id='treeview_ul_"+b+"'><li style='cursor:wait'><img alt='...' src='"+base_url+"img/treeview/loading.gif' border=0></li></ul>":"";h+='<li id="treeview_li_'+b+'" onclick="treeview_load_host_plans('+b+');"><span class="host_plan" style="float:left;">&nbsp;</span><font class="'+treeview_get_styles(b).join(" ")+'" id="treeview_span_'+b+"\" style=\"cursor:pointer\" onclick=\"if (selected) {    $('#'+selected).removeClass('over')}; selected = $(this).attr('id'); $(this).addClass('over'); treeview_update_field();\">"+get_name_from_path(file_system[b].path)+"</font>"+f+"</li>"}}$("#treeview_ul_"+c).empty();h=$(h).appendTo("#treeview_ul_"+c);if(!k){$("#treeview_ul_"+c).treeview({add:h});$("#treeview_ul_"+c).treeview({collapsed:true})}}}}catch(g){alert("treeview_new_items: "+g.message);_sys_error("Error:","Failed to append new items to treeview",g)}}function treeview_response_error(a){try{hide_absolutely_all_errors();displayMessageEx("something went really wrong",true,false)}catch(b){alert("treeview_response_error: "+b.message);_sys_error("Error:","Failed to process response error",b)}}function treeview_init(){if(treeview_control_is_disabled()){$("#treeview_reload_btn").hide();$("#treeview_ul_0").hide();$("#treeview_disabled_text").show();$("#frm_fs_path").val(temp_vars_set.start_host_plan);$("#frm_fs_path").removeAttr("readonly");remember_the_form();return}try{selected=null;last_auto_suggestion=$("#frm_type_domen").val();document_root=temp_vars_set.document_root;http_root=temp_vars_set.http_root;if(temp_vars_set.form_has_been_reloaded){last_auto_suggestion=temp_vars_set.last_auto_suggestion}file_system=new Array();eval(Base64.decode(temp_vars_set.file_system_javascript));var initially_loaded=new Array();var chosen=0;for(var i=0;i<file_system.length;i++){file_system[i].parent=get_host_plan_parent_id(file_system[i].path);if(treeview_host_plan_loaded(file_system[i].value)){initially_loaded.push(i)}if(treeview_host_plan_is_current(file_system[i].value)){chosen=i}}$("#treeview_ul_0").hide();treeview_new_items(initially_loaded,true);$("#treeview_ul_0").treeview({animated:"fast",collapsed:true});var opened=chosen;if(opened>0){while(opened!=-1){$("#treeview_li_"+opened+" > .hitarea").click();opened=file_system[opened].parent}}selected="treeview_span_"+chosen;$("#treeview_span_"+chosen).addClass("over");$("#treeview_ul_0").show();setTimeout("treeview_scroll_to_selected("+chosen+")",500);treeview_update_field(true);remember_the_form()}catch(e){alert("treeview_init: "+e.message);_sys_error("Error:","Failed to init treeview",e)}}function remember_the_form(){try{for(var i=0;i<form_fields.length;i++){if(temp_vars_set.form_has_been_reloaded){eval("form_initials["+i+"] = temp_vars_set.original_"+form_fields[i]+";")}else{form_initials[i]=$("#frm_"+form_fields[i]).val()}}if(temp_vars_set.form_has_been_reloaded){validator.checkAll()}}catch(e){alert("remember_the_form: "+e.message)}}function treeview_scroll_to_selected(b){try{$("#treeview_ul_0").scrollTop($("#treeview_li_"+b).offset().top-$("#treeview_ul_0").offset().top-1)}catch(a){alert("treeview_scroll_to_selected: "+a.message)}}function treeview_extract_selected_id(){return 1*selected.substr(selected.lastIndexOf("_")+1)}function treeview_reload(){try{var a=treeview_extract_selected_id();button_click_handler("reload")}catch(b){alert("treeview_reload: "+b.message)}}function treeview_update_field(d){try{var a=treeview_extract_selected_id();if(file_system[a]){var c=file_system[a].path;if(($("#frm_type_domen").val()=="")||($("#frm_type_domen").val()==last_auto_suggestion)){if((c.substr(0,document_root.length)==document_root)&&!d){last_auto_suggestion=http_root+c.substr(document_root.length);$("#frm_type_domen").val(last_auto_suggestion)}}$("#frm_fs_path").val(c);if(validator&&!d){validator.items.fs_path.check()}}}catch(b){alert("treeview_update_field: "+b.message)}}function testtt(){alert(validator.items.fs_path.error.text)}function treeview_get_styles(c){try{var a=new Array();a.push(treeview_directory_is_protectable(file_system[c].value)?"protectable":"non-protectable");a.push(treeview_directory_is_protected(file_system[c].value)?"protected":"not-protected");return a}catch(b){alert("treeview_get_styles: "+b.message)}}function someone_changed_something(){try{for(var a=0;a<form_fields.length;a++){if($("#frm_"+form_fields[a]).val()!=form_initials[a]){return true}}return false}catch(b){alert("someone_changed_something: "+b.message)}}function myPanelDestructor(){last_auto_suggestion=null;validator=null;file_system=null;selected=null;document_root=null;http_root=null;form_fields=null;form_initials=null}function myPanelOnLoad(){try{validator=new FormValidator();if($("#host_plan_list").length==0){validator.add("name","check_max_len(val, 255)&&check_min_len(val,1)");validator.items.name.checkOnEvent("keyup");validator.add("host_plan","check_max_len(val, 255)&&check_min_len(val,1)");validator.items.host_plan.checkOnEvent("onchange");validator.items.host_plan.checkOnEvent("keyup");validator.add("type_domen","check_max_len(val, 2048)&&check_min_len(val,1)");validator.items.type_domen.checkOnEvent("change");validator.items.type_domen.checkOnEvent("keyup");dirPanelLoadFlag=true}}catch(a){alert("myPanelOnLoad: "+a.message);_sys_error("Error:","Failed to load the panel",a)}}function can_be_protected(b){try{var c=get_directory_id_by_path(b);if(!file_system[c]){return false}if(file_system[c].path.length>2048){validator.items.fs_path.error.text=temp_vars_set.directory_path_is_too_long;return false}if(!treeview_directory_is_protectable(file_system[c].value)){validator.items.fs_path.error.text=temp_vars_set.directory_is_not_protectable;return false}if(treeview_directory_is_protected(file_system[c].value)){if(($("#frm_id").val()==0)||(($("#frm_id").val()!=0)&&(file_system[c].path!=form_initials[form_fields.indexOf("fs_path")]))){validator.items.fs_path.error.text=temp_vars_set.directory_is_already_protected;return false}}hide_absolutely_all_errors();validator.items.fs_path.error.text="";return true}catch(a){alert("can_be_protected: "+a.message)}}function button_click_handler(b){try{var d=getPagerParams();if(b=="reload"){d.action="reload";d.last_auto_suggestion=last_auto_suggestion;for(var a=0;a<form_fields.length;a++){d[form_fields[a]]=$("#frm_"+form_fields[a]).val()}on_post_error=host_plan_response_error;load_panel(base_url+"host_plans/host_plan_item",d,javascripts)}if(b=="cancel"){if((someone_changed_something()&&confirm(temp_vars_set.cancelText))||!someone_changed_something()){document.location.hash="#host_plans";load_panel(base_url+"host_plans/host_plans_list",d,javascripts)}}if(b=="save"){hide_absolutely_all_errors();d.action="save";for(var a=0;a<form_fields.length;a++){d[form_fields[a]]=$("#frm_"+form_fields[a]).val()}on_post_error=host_plan_response_error;document.location.hash="#host_plans";load_panel(base_url+"host_plans/host_plans_list",d,javascripts)}}catch(c){alert("button_click_handler: "+c.message)}}function host_plan_response_error(a){try{displayMessageEx(getTempVarsSet(false,a),true)}catch(b){alert("host_plan_response_error: "+b.message);_sys_error("Error:","Failed to parse error from server",b)}}function directory_response_additional(a){return;try{if(validator!=null){if(isset(a)||isset(window.directory_response_additional_cache)){a=isset(a)?a:window.directory_response_additional_cache;var c=false;if(a.charAt(0)=="-"){c=true;a=a.substr(1)}if(a=="directory_not_found_on_server"){form_initials[form_fields.indexOf("fs_path")]="";validator.items.fs_path.check()}displayMessageEx(a,c,true);if(isset(window.directory_response_additional_cache)){delete (window.directory_response_additional_cache)}}}else{window.directory_response_additional_cache=a}}catch(b){alert("directory_response_additional: "+b.message);_sys_error("Error:","Failed to parse additional response from server",b)}};
