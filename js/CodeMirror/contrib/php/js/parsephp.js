if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){var a=this.length;var c=Number(arguments[1])||0;c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1}}var PHPParser=Editor.Parser=(function(){var c={atom:true,number:true,variable:true,string:true};function e(k,g,f,j,h,i){this.indented=k;this.column=g;this.type=f;if(j!=null){this.align=j}this.prev=h;this.info=i}var a=4;function b(f){return function(h){var j=h&&h.charAt(0),i=f.type;var g=j==i;if(i=="form"&&j=="{"){return f.indented}else{if(i=="stat"||i=="form"){return f.indented+a}else{if(f.info=="switch"&&!g){return f.indented+(/^(?:case|default)\b/.test(h)?a:2*a)}else{if(f.align){return f.column-(g?1:0)}else{return f.indented+(g?0:a)}}}}}}function d(w,I){var z=tokenizePHP(w);var A=[J];var f=new e((I||0)-a,0,"block",false);var j=0;var D=0;var r,C;var k={next:B,copy:G};function B(){while(A[A.length-1].lex){A.pop()()}var M=z.next();if(M.type=="whitespace"&&j==0){D=M.value.length}j+=M.value.length;if(M.content=="\n"){D=j=0;if(!("align" in f)){f.align=false}M.indentation=b(f)}if(M.type=="whitespace"||M.type=="comment"||M.type=="string_not_terminated"){return M}if(!("align" in f)){f.align=true}while(true){r=C=false;var N=A.pop();N(M);if(r){if(C){M.style=C}return M}}return 1}function G(){var N=f,O=A.concat([]),M=z.state;return function P(Q){f=N;A=O.concat([]);j=D=0;z=tokenizePHP(Q,M);return k}}function n(M){for(var N=M.length-1;N>=0;N--){A.push(M[N])}}function i(){n(arguments);r=true}function g(){n(arguments);r=false}function s(M){C=M}function K(M){C=C+" "+M}function m(O,P){var N=function M(){f=new e(D,j,O,null,f,P)};N.lex=true;return N}function v(){f=f.prev}v.lex=true;function l(N){return function M(O){if(O.type==N){i()}else{i(arguments.callee)}}}function q(M,O){return function N(Q){var P;var R=Q.type;if(typeof(M)=="string"){P=(R==M)-1}else{P=M.indexOf(R)}if(P>=0){if(O&&typeof(O[P])=="function"){O[P](Q)}i()}else{if(!C){s(Q.style)}K("syntax-error");i(arguments.callee)}}}function J(M){return g(h,J)}function h(M){var N=M.type;if(N=="keyword a"){i(m("form"),y,h,v)}else{if(N=="keyword b"){i(m("form"),h,v)}else{if(N=="{"){i(m("}"),p,v)}else{if(N=="function"){L()}else{if(N=="class"){i(q("t_string"),l("{"),m("}"),p,v)}else{if(N=="foreach"){i(m("form"),q("("),m(")"),y,q("as"),q("variable"),l(")"),v,h,v)}else{if(N=="for"){i(m("form"),q("("),m(")"),y,q(";"),y,q(";"),y,q(")"),v,h,v)}else{if(N=="modifier"){i(q(["modifier","variable","function"],[null,null,L]))}else{if(N=="switch"){i(m("form"),q("("),y,q(")"),m("}","switch"),q([":","{"]),p,v,v)}else{if(N=="case"){i(y,q(":"))}else{if(N=="default"){i(q(":"))}else{if(N=="catch"){i(m("form"),q("("),q("t_string"),q("variable"),q(")"),h,v)}else{if(N=="const"){i(q("t_string"))}else{if(N=="namespace"){i(t,q(";"))}else{g(m("stat"),y,q(";"),v)}}}}}}}}}}}}}}}function y(M){var N=M.type;if(c.hasOwnProperty(N)){i(F)}else{if(N=="<<<"){i(q("string"),F)}else{if(N=="t_string"){i(H,F)}else{if(N=="keyword c"){i(y)}else{if(N=="("){i(m(")"),u(y),q(")"),v,F)}else{if(N=="operator"){i(y)}}}}}}}function F(M){var N=M.type;if(N=="operator"){if(M.content=="?"){i(y,q(":"),y)}else{i(y)}}else{if(N=="("){i(m(")"),y,u(y),q(")"),v,F)}else{if(N=="["){i(m("]"),y,q("]"),F,v)}}}}function H(M){if(M.type=="t_double_colon"){i(q(["t_string","variable"]),F)}else{g(y)}}function L(){i(q("t_string"),q("("),m(")"),u(E),q(")"),v,p)}function u(N){function M(P){if(P.type==","){i(N,M)}}return function O(){g(N,M)}}function p(M){if(M.type=="}"){i()}else{g(h,p)}}function o(M){if(M.content=="="){i(y)}}function E(M){if(M.type=="t_string"){i(q("variable"),o)}else{if(M.type=="variable"){i(o)}}}function x(M){if(M.type=="t_double_colon"){i(t)}}function t(M){g(q("t_string"),x)}return k}return{make:d,electricChars:"{}:",configure:function(f){if(f.indentUnit!=null){a=f.indentUnit}}}})();
