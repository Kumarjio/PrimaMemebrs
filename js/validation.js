function FormValidator(){this.scan=function(a){if(isset(a)){var b=$(a);b=b.length>0?b:$("#"+a);b=b.length==0?b:b.find(":input")}else{b=this.allFields.filter(".quickvalidator")}var c=this;b.each(function(f,h){var e=h.className.toString().split(/\s+/);var d=$(h).attr("name");var g=new Array();if($(h).attr("name")){if($(h).hasClass("qv_required")){g.val=$("label[@for='"+d+"']>.add_field_error_text>.qv_required").html()}if($(h).hasClass("qv_numbers")){g["check_int(val)||!val"]=$("label[@for='"+d+"']>.add_field_error_text>.qv_numbers").html()}if($(h).hasClass("qv_email")){g["check_mail(val)||!val"]=$("label[@for='"+d+"']>.add_field_error_text>.qv_email").html()}if($(h).hasClass("qv_phone")){g["check_phone(val)||!val"]=$("label[@for='"+d+"']>.add_field_error_text>.qv_phone").html()}if($(h).hasClass("qv_date")){g["check_date(val)||!val"]=$("label[@for='"+d+"']>.add_field_error_text>.qv_phone").html()}c.add(d,g);c.items[d].checkOnEvent("keyup");c.items[d].checkOnEvent("click")}})};this.allFields=$(":input");this.border;this.onCheck;this.submitter;this.setOnCheck=function(a){if(!a||typeof(a)=="function"){this.onCheck=a;for(name in this.items){if(typeof(this.items[name])!="function"){this.items[name].onCheck=a}}}else{alert(a+" is not a function!")}};this.items=new Array();this.error_style;this.add=function(b,d,a){try{this.items[b]=new FormField(this,b,d,a);this.items[b].error.style=this.error_style?this.error_style:this.items[b].error.style;this.items[b].border=this.border?this.border:this.items[b].border;this.items[b].border=this.border===false?"":this.items[b].border;if(this.onCheck){this.items[b].onCheck=this.onCheck}}catch(c){alert("this.add: "+c.message)}};this.displayedMessages=false;this.checkAll=function(c){var a=true;try{this.displayedMessages={};for(key_name in this.items){if(typeof(this.items[key_name])!="function"){this.items[key_name].check(c);a=this.items[key_name].error.is_error?!this.items[key_name].error.is_error:a}}displayMessageEx(this.displayedMessages,true);this.displayedMessages=false}catch(b){alert("checkAll: "+b.message)}return a};this.isChanged=function(c){try{var a=isset(c)?c:this.items;for(key_name in a){if(typeof(a[key_name])!="function"){key_name=isset(c)?a[key_name]:key_name;if(isset(this.items[key_name])&&typeof(this.items[key_name])!="function"){if(this.items[key_name].isChanged()){return true}}}}}catch(b){alert("isChanged: "+b.message)}return false};this.reset=function(c){try{var a=isset(c)?c:this.items;for(key_name in a){if(typeof(a[key_name])!="function"){key_name=isset(c)?a[key_name]:key_name;if(isset(this.items[key_name])&&typeof(this.items[key_name])!="function"){this.items[key_name].reset()}}}}catch(b){alert("reset: "+b.message)}};this.getItems=function(){try{var a=new Array();this.checkAll(false);for(key_name in this.items){if(typeof(this.items[key_name])!="function"){a[key_name]=this.items[key_name].value}}return a}catch(b){alert("getItems: "+b.message)}}}function FormField(parent,name,params,err_text){this.parent=parent;this.border="1px #FF3333 solid";this.onCheck;this.getErrorText=function(){var name=this.name;return $("#emsg_"+name).text()?$("#emsg_"+name).text():"Error is not defined!"};this.name=name;this.id="";var t_elem=this.parent.allFields.filter("[@name='"+this.name+"']");if(t_elem.length==0){t_elem=$(":input[@name='"+this.name+"']")}if(t_elem.length==0){t_elem=$("[@name='"+this.name+"']")}var t_id=t_elem.attr("id");if(t_id==undefined||t_id==""||t_id=="undefined"){this.id="field_"+this.name.split("[]").join("");t_id=t_elem.attr("id",this.id)}else{this.id=t_id}this.submitter=false;var this_elem=this;var obj=this.parent;$("#"+this.id).keypress(function(event){if(event.keyCode==13){if(this_elem.submitter){this_elem.submitter(event)}else{if(obj.submitter){obj.submitter(event)}}}});this.error=new Array();this.error.validation=true;this.error.is_error=false;this.error.text=err_text?err_text:this.getErrorText();this.error.style='style="color: #ff0000; font-size: xx-small;"';if(typeof(params)=="object"){this.rules=params;this.rule="extended"}else{this.rule=params}this.value="";this.getValue=function(){var value="";try{var name=this.name;var elem=$("#"+this.id);var type=elem.attr("type");switch(type){case"checkbox":value=(elem.attr("checked"))?true:false;break;case"radio":var elem=this.parent.allFields.filter("[@name="+this.name+"]");value=elem.filter(":checked").val()||"";break;default:value=elem.val()||"";break}}catch(e){_sys_error("getValue:","FAIL",e)}return value};this.setValue=function(val){this.value=val;$("#"+this.id).val(val)};this.default_value=this.getValue();this.isChanged=function(){var value=this.getValue();if((this.default_value instanceof Array)){if(this.default_value.length!=value.length){return true}for(key in this.default_value){if(this.default_value[key]!=value[key]){return true}}}else{if(this.default_value!=value){return true}}return false};this.reset=function(){this.setValue(this.default_value)};this.check=function(callback){try{this.error.is_error=false;var name_temp=this.name;name_temp=(typeof(name_temp)=="object")?name.name:name_temp;var show=callback===false?false:true;var error_text;var is_def=false;var flag=true;if(this.error.validation){flag=this.internalCheck()}error_text=this.error.text;if(!(typeof(callback)=="function")){error_text=callback?callback:error_text;callback="this.drawError";is_def=true}show=flag?false:show;try{eval((is_def?callback:"callback")+"('"+name_temp+"','"+addslashes(this.value)+"','"+addslashes(error_text)+"',"+show+")")}catch(e){_sys_error("check->eval:","FAIL",e)}if(this.onCheck){this.onCheck()}}catch(e){alert("check: "+e.message)}return flag};this.showError=function(param,style,border){try{var style_temp=this.error.style;if(style!=undefined&&style!=false){this.error.style=style}if(border!=undefined&&border==false){new_style=old_style}var name=this.name;name=(typeof(name)=="object")?name.name:name;var show=param===false?false:true;var error_text=this.error.text;error_text=param?param:error_text;var callback="this.drawError";eval(callback+"('"+name+"','"+addslashes(this.value)+"','"+addslashes(error_text)+"',"+show+")");this.error.style=style_temp;new_style=""}catch(e){alert("showError: "+e.message)}};this.checkOnEvent=function(event,callback){try{var obj=this;$("#"+obj.id).bind(event,function(){obj.check(callback)})}catch(e){alert("check: "+e.message)}};this.server=new Array();this.server.url="";this.server.params="";this.server.callback=function(data){if(data.is_error){if(data.error_text!=""){window.panelValidatorObject.items[data.name].showError(data.error_text)}else{window.panelValidatorObject.items[data.name].showError()}}};this.checkOnServer=function(url,params,event,callback){this.server.url=url;this.server.params=params;if(typeof(callback)=="function"){this.server.callback=callback}window.panelValidatorObject=this.parent;if(typeof(event)=="undefined"||event==false){serverCheck(this.name,this.value,"","")}else{this.checkOnEvent(event,serverCheck)}};function serverCheck(name,value,error,show){try{if(isset(window.panelValidatorObject)&&window.panelValidatorObject!=null&&isset(window.panelValidatorObject.items)&&isset(window.panelValidatorObject.items[name])){if(!window.panelValidatorObject.items[name].check()){return}var params_arr={name:name};params_arr.value=value;if(typeof(window.panelValidatorObject.items[name].server.params)=="object"){for(key in window.panelValidatorObject.items[name].server.params){params_arr[key]=window.panelValidatorObject.items[name].server.params[key]}}on_post_message=function(msg){try{var data;data=getTempVarsSet(data,msg);for(key in data){if((typeof(data[key])!="function")){data[key]["value"]=Base64.decode(data[key]["value"]);if(window.panelValidatorObject.items[key].value==data[key]["value"]){var error_text="";if(data[key]["error_text"]!=undefined&&data[key]["error_text"]!=""){if(temp_vars_set[data[key]["error_text"]]!=undefined&&temp_vars_set[data[key]["error_text"]]!=""){error_text=temp_vars_set[data[key]["error_text"]]}else{var mess_set=$("div.mess_err");var temp=mess_set.find("#emsg_"+data[key]["error_text"]);error_text=temp.text()}}data[key]["name"]=key;data[key]["error_text"]=error_text;window.panelValidatorObject.items[key].error.is_error=data[key]["is_error"];try{window.panelValidatorObject.items[key].server.callback(data[key])}catch(e){alert("window.panelValidatorObject.items['"+key+"'].callback("+window.panelValidatorObject.items[key].callback+"): "+e.message)}}else{window.panelValidatorObject.items[key].check()}}}return true}catch(e){alert(print_r(e.message))}};load_message(window.panelValidatorObject.items[name].server.url,params_arr)}}catch(e){alert("checkOnServer: "+e.message)}}this.internalCheck=function(){try{var value=this.getValue();this.value=value;if(!(value instanceof Array)){value=new Array();value[0]=this.value}for(key in value){if(typeof(value[key])!="function"){var val=value[key];if(this.rule!=undefined&&this.rule!=""&&!(this.error.is_error)){try{if(this.rule=="extended"){this.error.is_error=false;this.error.text="";for(rule in this.rules){if(typeof(this.rules[rule])!="function"&&!eval(addslashes(rule))){this.error.is_error=true;this.error.text+=$("#emsg_"+this.rules[rule]).text()?$("#emsg_"+this.rules[rule]).text():this.rules[rule]+"<br/>"}}}else{this.error.is_error=!eval(addslashes(this.rule))}}catch(e){alert(e.message)}}}}}catch(e){_sys_error("internalCheck:","FAIL",e)}return !this.error.is_error};var old_style=$("#"+this.id).attr("style");var new_style="";this.drawError=function(name,val,error,show){try{e=$("label[@for='"+name+"']");if(e.length>0){if(e.find("#err_"+this.id).length>0){if(e.find("#err_"+this.id).text()==error&&show){return}e.find("#err_"+this.id).remove();if(old_style==undefined||old_style==""){$("#"+this.id).removeAttr("style")}else{$("#"+this.id).attr("style",old_style)}}if(show){e.append('<div id="err_'+this.id+'" '+this.error.style+">"+error+"</div>");e.find("#err_"+name).text(error);if($("#"+this.id).attr("style")!=new_style){old_style=$("#"+this.id).attr("style");$("#"+this.id).css({border:this.border});new_style=new_style?new_style:$("#"+this.id).attr("style")}}}else{if(show){if(this.parent.displayedMessages!==false){this.parent.displayedMessages[name]=error}else{displayMessageEx(error,true)}}}}catch(e){_sys_error("drawError:","FAIL",e)}};function addslashes(str){if(typeof(str)=="string"){str=str.replace(/\\/g,"\\\\");str=str.replace(/\'/g,"\\'");str=str.replace(/\"/g,'\\"');str=str.replace(/\0/g,"\\0");str=str.replace(/\n/g,"\\n");str=str.replace(/\r/g,"\\r")}return str}}function check_url(b){var a=/^((ssl|news|telnet|nttp|file|http|ftp|https):\/\/){0,1}(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i;return a.test(b)}function check_extention(b){var a=/^[^\\\/:;\*\?\"\<\>\'\|\.,&]+$/;return a.test(b)}function check_int_limit(a,f,b){var h=/\d*/;var c=/\./;var i=c.test(a);var d=parseInt(a,10);var g=Infinity;if(f!=false){g=parseInt(f,10)}var e=parseInt(b,10);if(isNaN(a)||!a||i){return false}else{if((d>g)||(d<e)){return false}}return true}function check_int_max(c,b){var a=parseInt(b);if(isNaN(c)){return false}else{if(c>a){return false}}return true}function check_phone(b){var a=/^[-0-9()+ ]+$/;return a.test(b)}function check_date_format(b){var a=/^[dDmMyY]{1}[-.\/]{1}[dDmMyY]{1}[-.\/]{1}[dDmMyY]{1}$/;if(a.test(b)&&/[dD]{1}/.test(b)&&/[mM]{1}/.test(b)&&/[yY]{1}/.test(b)&&b.charAt(1)==b.charAt(3)){return true}return false}function check_date(a,b){return(convert_date(a,b)===false)?false:true}function check_time(b){var a=/^[0-9]{2}:[0-9]{2}:[0-9]{2}$/;return a.test(b)}function check_datetime(b){var a=/^[0-9]{2}\.[0-9]{2}\.[0-9]{4} [0-9]{2}:[0-9]{2}:[0-9]{2}$/;return a.test(b)}function check_mail(b){var a=/^[a-zA-Z0-9_\.\-]+@([a-zA-Z0-9][a-zA-Z0-9-]*\.)+[a-zA-Z]{2,6}$/;return a.test(b)}function check_email_domain(b){var a=/^([a-zA-Z0-9][a-zA-Z0-9_-]+\.)+[a-zA-Z]{2,6}$/;return a.test(b)}function check_int(b){var a=/^[0-9]+$/;return a.test(b)}function check_amount(b){var a=/^[0-9]+(\.[0-9]{0,2})?$/;return a.test(b)}function check_alpha(b){var a=/^[a-zA-Z]+$/;return a.test(b)}function check_alpha_and_int(b){var a=/^[a-zA-Z0-9]+$/;return a.test(b)}function check_max_len(b,a){var c=parseInt(a);if(b.length>a){return false}return true}function check_min_len(b,a){var c=parseInt(a);if(b.length<a){return false}return true}function check_len(c,b,a){return(check_min_len(c,b)&&check_max_len(c,a))}function check_ip(c){var b=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/;if(!b.test(c)){return false}var a=b.exec(c);return(a[1]<256)&&(a[2]<256)&&(a[3]<256)&&(a[4]<256)}function check_ip_range(c){var b=/^(\d{1,3}|\*)\.(\d{1,3}|\*)\.(\d{1,3}|\*)\.(\d{1,3}|\*)$/;var a=/^(\d{1,3}|\*)\.(\d{1,3}|\*)\.(\d{1,3}|\*)\.(\d{1,3}|\*)-(\d{1,3}|\*)\.(\d{1,3}|\*)\.(\d{1,3}|\*)\.(\d{1,3}|\*)$/;if(!b.test(c)&&!a.test(c)){return false}return true}function check_user_pwd(b){var a=/[^a-zA-Z0-9\!@#$%^&*=+\/~<>?;-]/;if(a.test(b)){return 0}if(b.length<5){return 0}if(checkA(b)&&checkB(b)&&checkC(b)&&checkD(b)){return 5}if(checkA(b)&&checkB(b)&&(checkC(b)||checkD(b))){return 4}if((checkA(b)||checkC(b))&&(checkB(b)||checkD(b))){return 3}if(checkA(b)||checkB(b)||checkC(b)){return 2}return 0}function check_admin_pwd(b){var a=/[^a-zA-Z0-9\!@#$%^&*=+\/~<>?;-]/;if(a.test(b)){return 0}if(b.length<7||b.length>64){return 0}if(checkA(b)&&checkB(b)&&checkC(b)&&checkD(b)){return 5}if(checkA(b)&&checkB(b)&&(checkC(b)||checkD(b))){return 4}if((checkA(b)||checkC(b))&&(checkB(b)||checkD(b))){return 3}if(checkA(b)||checkB(b)||checkC(b)){return 2}return 0}function check_user_login(b){if(b.length<4){return false}var a=/^[a-z].*/;if(a.test(b)&&(checkA(b)||(checkB(b)||checkC(b)))){return true}return false}function check_admin_login(b){if(b.length<5){return false}var a=/^[a-zA-Z].*/;if(!a.test(b)){return false}return true}function check_available_login(a){try{on_post_success=function(c){if(c=="true"){if(after_login_available_check){after_login_available_check(true)}}else{if(after_login_available_check){after_login_available_check(false)}}};on_post_error=function(c){return false};start_request(base_url+"user/check_available_login",{login:trim(a)})}catch(b){_sys_error("check_available_login","",b)}}function check_available_email(a,b){try{on_post_success=function(d){if(d=="true"){if(after_email_available_check){after_email_available_check(true)}}else{if(after_email_available_check){after_email_available_check(false)}}};on_post_error=function(d){return false};start_request(base_url+"user/check_available_email",{email:trim(a),domain_check:parseInt(b)})}catch(c){_sys_error("check_available_email","",c)}}function check_login(b){if(b.length<4){return false}if(b.length>64){return false}var c=/[^_a-zA-Z0-9-]/;if(c.test(b)){return false}var a=/^[a-zA-Z].*/;if(a.test(b)&&(checkA(b)||checkB(b)||checkC(b))){return true}return false}function checkA(c,b){var b=parseInt(b);if(b==1){var a=/^[a-z]+$/}else{var a=/[a-z]+/}return a.test(c)}function checkB(c,b){var b=parseInt(b);if(b==1){var a=/^[0-9]+$/}else{var a=/[0-9]+/}return a.test(c)}function checkC(c,b){var b=parseInt(b);if(b==1){var a=/^[A-Z]+$/}else{var a=/[A-Z]+/}return a.test(c)}function checkD(c,b){var b=parseInt(b);if(b==1){var a=/^[\-!@#$%^&*=+\/~<>?;]+$/}else{var a=/[\-!@#$%^&*=+\/~<>?;]+/}return a.test(c)}function check_subscr_cancel_check(){hide_form_errors();if($("input[@name=ch]").val()!=$("input[@name=ch_e]").val()){show_form_errors(2);return false}return true};
