function myPanelOnLoad(){var a=new Thread(function(){if(temp_vars_set.panel_name=="manage_pages"){$("#manage_pages_list").tableDnD({onDragStyle:{border:"5"},onDrop:function(d,e){$(e).removeClass("light");$(e).addClass("dark");resortRow(d,e)},onDragStart:function(d,e){$(e).removeClass("dark");$(e).addClass("light")}});$("a.clipboard").clipboard(copyLinkToClipboard)}var b=new Array();if(!window.cashedRows){window.cashedRows={}}window.cashedRows.manage_pages=$("#manage_pages_list").find("tbody").find("tr:last").clone();var c=$("#manage_pages_list").find("tbody").find("tr").each(function(d,e){b.push(e.id.split("_")[1])});last_sort_img=b.join(",");inlineTextEditInit();initDatePicker()});on_post_error=save_error;additional_accept=after_save}function initDatePicker(b){try{if(b){datePickerController.create();try{datePickerController.init()}catch(c){}var a=$("div#fd-dateEntry_"+b+">table>tbody>tr>td")}else{var a=$("div.datePicker>table>tbody>tr>td")}a.click(function(){var e=$(this).parent().parent().parent().parent().attr("id").substr(3);var d=new Thread(function(){$("#"+e).siblings("span").html($("#"+e).val());on_post_message=successMessage;var f={action:""};f.type="edit";f.id=e.split("_")[1];f.date=$("#"+e).val();load_message(base_url+temp_vars_set.controller_action,f)},100)})}catch(c){alert("initDatePicker:"+c.message)}}function inlineTextEditInit(){$("#manage_pages_list").find("tbody").find("tr").find("td:eq(1)").dblclick(function(){inlineTextEdit(this)});$("#manage_pages_list").find("tbody").find("tr").find("td:eq(1)").click(function(){inlineTextEditClick(this)});$(".inlineDateEdit").dblclick(function(){inlineTextEdit(this)})}inlineTextEditElement=null;inlineTextEditElementError=null;window.cashedSids={};window.cashedDate={};function inlineTextEdit(c){if(inlineTextEditElement!=c){if($("#input_ex_temp").length>0){editSid()}inlineTextEditElement=c;delete (validator);if($(c).find(".input_ex_error").length>0){inlineTextEditElementError=$(c).html();var d=$(c).find(".input_ex_error").html()}else{var d=$(c).html()}var a=$(c).width();var b=$(c).height();$(c).html("<input style='border:0;' value='"+d+"' id='input_ex_temp' name='input_ex_temp' type='text'/><span style='display:none;' id='input_ex_default'>"+d+"</span>");$("#input_ex_temp").css("background-color",$(c).css("background-color"));$("#input_ex_temp").css("text-align","center");if($(c).is(".inlineDateEdit")){$("#input_ex_temp").width(a);$("#input_ex_temp").height(b)}else{$("#input_ex_temp").width(a-6);$("#input_ex_temp").height(b-6)}$("#input_ex_temp").focus();$("#input_ex_temp").blur(function(e){inlineTextEditElement=editSid()});validator=new FormValidator();if($(c).is(".inlineDateEdit")){validator.add("input_ex_temp","check_date(val)&&val")}else{validator.add("input_ex_temp","checkSid(val)&&val")}validator.items.input_ex_temp.checkOnEvent("keyup",inlineTextEditShowError)}}function checkSid(b){var a=/^[a-zA-Z0-9-]+$/;return a.test(b)}function inlineTextEditShowError(c,d,b,a){if(a){$("#input_ex_temp").css("color","red")}else{$("#input_ex_temp").css("color","black")}}function inlineTextEditClick(a){if(inlineTextEditElement!=a&&$("#input_ex_temp").length>0){inlineTextEditElement=editSid()}}function editSid(){var b=inlineTextEditElement;var d=$("#input_ex_temp").val();var a=$("#input_ex_default").html();if(validator.items.input_ex_temp.check(false)==false){d=a}$(b).html(d);if(d!=a){if($(b).is("span")){var e=$(b).parent().parent().attr("id").split("_")[1];$("#dateEntry_"+e).val(d);window.cashedDate[e]=a}else{var e=$(b).parent().attr("id").split("_")[1];window.cashedSids[e]=a}on_post_message=successMessage;var c={action:""};c.type="edit";c.id=e;c[$(b).is("span")?"date":"sid"]=$(b).html();load_message(base_url+temp_vars_set.controller_action,c)}else{if(inlineTextEditElementError!=null){$(b).html(inlineTextEditElementError);$(b).find(".input_ex_error").tooltip({bodyHandler:function(){return $(this).siblings(".input_ex_error_text").html()},showURL:false})}}inlineTextEditElementError=null;return null}function myPagerHandler(a){load_panel(base_url+temp_vars_set.controller,a,{"0":base_url+"js/admin/init.js"})}function myPanelDestructor(){delete (validator)}function after_save(b){var a=getTempVarsSet(false,b);displayMessageEx(a)}function save_error(b){var a=getTempVarsSet(false,b);displayMessageEx(a,true)}function pageAction(c,a){on_post_message=successMessage;var b={action:"click"};b.type=a;b.id=c;b.status=$("#img_"+a+"_"+c+":visible").length;load_message(base_url+temp_vars_set.controller_action,b)}var last_sort_img;function resortRow(c,e){var a=new Array();var f=$(c).find("tbody").find("tr").each(function(g,h){a.push(h.id.split("_")[1])});var b=a.join(",");if(b!=last_sort_img){last_sort_img=b;on_post_message=successMessage;var d={action:""};d.type="sort";last_sort_img=a.join(",");d.pos=last_sort_img;load_message(base_url+temp_vars_set.controller_action,d)}}function fieldEdit(c,a){if(isset(a)){parm={id:""};parm.id=parseInt(c);parm.sid=$("tr#field_"+c).children("td:eq(1)").text();fieldLangsEdit(temp_vars_set.object_type,parm)}else{fieldLangsEdit(temp_vars_set.object_type,c)}return;if(c!=0){var b={action:""};b.object_type=temp_vars_set.object_type;b.id=c;b.template_name=$("tr#field_"+c).children("td:eq(1)").text();b.referer=document.location.hash.substr(1);load_panel(base_url+"lang_manager/edit/",b,{"0":base_url+"js/admin/init.js"})}}function fieldAdd(a){if($("#empty_row").length>0){$("#empty_row").hide()}if(!isset(a)){createRow()}on_post_message=successMessage;var b={action:""};b.type="add";b.pos=last_sort_img;load_message(base_url+temp_vars_set.controller_action,b)}function fieldDelete(b){if(b!=0){if(confirm(temp_vars_set.are_you_sure)){on_post_message=successMessage;var a={action:""};a.type="remove";a.id=b;load_message(base_url+temp_vars_set.controller_action,a)}}}function createRow(){try{var f={};f.id="new";f.sid=temp_vars_set.processing;f.published=0;f.show_in_menu=1;f.members_only=0;var a=$("#manage_pages_list").find("tbody").find("tr");var c=a.length;var d=window.cashedRows.manage_pages.clone();d.appendTo($("#manage_pages_list").find("tbody"));jQueryReset(d);if(c>0&&a.filter(".light").length>0&&a.filter(".dark").length>0){d.removeClass("dark");d.removeClass("light");d.addClass(a.filter("tr:last").is(".dark")?"light":"dark")}d.show();d.attr("id","field_new");editingRow("new",f)}catch(b){alert("createRow:"+b.message)}}function jQueryReset(c){try{var b=c.clone().wrap("<div></div>").parent();var a="jQuery"+b.html().split("jQuery",2)[1].split("=",1)[0];b.remove();c.find("*").removeAttr(a);c.removeAttr(a)}catch(d){}}function editingRow(a,j){try{var c=j.id;var d=j.sid;var h=j.date;var l=j.published;var g=j.show_in_menu;var f=j.members_only;var m=$($("#manage_pages_list").find("tbody").find("tr#field_"+a)[0]);inlineTextEditInit();if(temp_vars_set.panel_name=="manage_pages"){$("#manage_pages_list").tableDnDUpdate()}m.attr("id","field_"+c);if(c=="new"){c=0}m.find("a").each(function(p,r){var q=r.onclick.toString();q=q.indexOf("function")>=0?q.substring(q.indexOf("{")+1,q.lastIndexOf("}")):q;if(q.indexOf(")")>0){var e=q.split(")");var o=(e[0].split("(")[1]).split(",");o[0]=c;e[0]=(e[0].split("(")[0])+"("+o.join(",");q=e.join(")");r.onclick=new Function(q)}});var b=m.find("a.clipboard");if(b.length>0){b.attr("id","link_source_"+c);b.clipboard(copyLinkToClipboard)}var i=m.find("td:eq(0)");$(i).find("div:eq(0)").attr("id","img_published_"+c);$(i).find("div:eq(1)").attr("id","img_un_published_"+c);m.find("td:eq(1)").html(d);if(j.date){m.find(".inlineDateEdit").html(h);m.find(".inlineDateEditTemp").val(h);m.find(".inlineDateEditTemp").attr("name","date_from_"+c);m.find(".inlineDateEditTemp").attr("id","dateEntry_"+c);m.find("button").remove();initDatePicker(c)}if(j.show_in_menu){i=m.find("td:eq(2)");$(i).find("div:eq(0)").attr("id","img_show_in_menu_"+c);$(i).find("div:eq(1)").attr("id","img_un_show_in_menu_"+c)}i=m.find("td:eq(3)");if(temp_vars_set.panel_name=="manage_pages"){m.find("td:eq(1)").attr("title",base_url+"user/page/"+d)}$(i).find("div:eq(0)").attr("id","img_members_only_"+c);$(i).find("div:eq(1)").attr("id","img_un_members_only_"+c);checkMyFlag(c,"published",l);checkMyFlag(c,"show_in_menu",g);checkMyFlag(c,"members_only",f)}catch(k){alert("editingRow:"+k.message)}}function checkMyFlag(c,b,a){if(a==1){$("#img_"+b+"_"+c).show();$("#img_un_"+b+"_"+c).hide()}else{$("#img_"+b+"_"+c).hide();$("#img_un_"+b+"_"+c).show()}}function successMessage(g){var c;c=getTempVarsSet(c,g);if(isset(c.disabled)){displayMessageEx(c.error,true)}else{displayMessageEx(false,true,false)}switch(c.type){case"edit":if(c.status==1){messageFade("edit_field_success",false,false,true);if(temp_vars_set.panel_name=="manage_pages"){var b=$("#manage_pages_list").find("tbody").find("tr#field_"+c.id).find("td:eq(1)");b.attr("title",base_url+"user/page/"+c.sid)}}else{var f=$(".mess_err").find("#emsg_"+c.error);var a=f.length>0?f.html():c.error;if(c.date){var b=$("#manage_pages_list").find("tbody").find("tr#field_"+c.id).find(".inlineDateEdit");var e=c.date}else{var b=$("#manage_pages_list").find("tbody").find("tr#field_"+c.id).find("td:eq(1)");var e=c.sid}b.html("<span class='input_ex_error' style='color:red;'>"+e+"</span><span class='input_ex_error_text' style='display:none;'>"+a+"</span>");b.find(".input_ex_error").tooltip({bodyHandler:function(){return $(this).siblings(".input_ex_error_text").html()},showURL:false});if(isset(c.error)&&!isset(c.disabled)){messageFade(c.error,true,false,true)}}break;case"add":messageFade("add_field_success",false,false,true);editingRow("new",c);break;case"sort":if(c.pos==last_sort_img){messageFade("success_message",false,false,true)}break;case"remove":if(c.status==1){var d=$("tr#field_"+c.id);d.remove();if($("#manage_pages_list tbody tr:visible").length<=0&&$("#empty_row").length>0){$("#empty_row").show()}messageFade("success_delete",false,false,true)}break;default:if(c.status==1){messageFade("success_message",false,false,true);$("#img_"+c.type+"_"+c.id).show();$("#img_un_"+c.type+"_"+c.id).hide()}else{if(c.status=="news_empty"){messageFade("success_message",false,false,true)}else{$("#img_"+c.type+"_"+c.id).hide();$("#img_un_"+c.type+"_"+c.id).show()}}break}return 1}function copyLinkToClipboard(b){b=b.replace("link_source_","");var a=$("#manage_pages_list").find("tbody").find("tr#field_"+b).find("td:eq(1)");if(a.length>0){new Thread(function(){messageFade("copy_link_success",false,false,true)});return a.attr("title")}}document.images.preload=function(c){try{preload_array=(typeof(preload_array)=="undefined")?new Array():preload_array;var a=(c instanceof Array)?c:arguments;$.each(a,function(e,f){var d=new Image();d.src=f;preload_array.push(d)})}catch(b){"document.images.preload:"+alert(b)}};
