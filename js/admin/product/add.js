var product_id=null;function click_add(){hide_form_errors();if(check_inputs()){send_add()}}function clickMemberGroupsVisible(c){if($(c).is(":checked")){var b=$(c).parents("tr.dropbox_table").find(".member_group_available");b.attr("disabled",false)}else{var b=$(c).parents("tr.dropbox_table").find(".member_group_available");b.attr("checked",false);b.attr("disabled",true)}}function getMemberGroupsResult(){var b=[];var a=[];$(".member_group_visible:checked").each(function(){b.push($(this).val());if($(this).parents("tr.dropbox_table").find(".member_group_available:checked").length>0){a.push($(this).val())}});return{visible:b,available:a,warning:(b.length>0?false:true)}}function send_add(){var a=getMemberGroupsResult();if(!a.warning||confirm($("#member_group_warning").html())){on_post_success=add_response_success;on_post_error=add_response_error;var b={action:"add",name:$("#p_name").val(),descr:$("#p_descr").val(),group:$("#p_groups").val(),"prices[]":new Array($("#p_p_day").val(),$("#p_p_month").val(),$("#p_p_month3").val(),$("#p_p_month6").val(),$("#p_p_year").val(),$("#p_p_year5").val()),product_type:$("#p_product_type").val(),"dirs[]":($("#p_product_type").val()==2)?$("#p_hosts").val():$("#p_dirs").val(),trial_price:$("#p_trial_price").val(),trial_period_value:$("#p_trial_period_value").val(),trial_period_type:$("#p_trial_period_type").val(),cumulative:$("#p_cumulative").val(),discount_type:($("#p_disc_type_percent").attr("checked")?1:2),discount_value:$("#p_disc_value").val(),reccuring:($("#p_rec_yes").attr("checked")?2:1),free:($("#product_free").attr("checked")?2:1),"member_groups_visible[]":a.visible,"member_groups_available[]":a.available};document.location.hash="#products_list";load_panel(base_url+"product/add",b)}}function add_response_success(a){ImageUploader.init_iframe("img_upload_iframe");after_panel_load=after_product_add;if(!ImageUploader.check_input()){get_product_list()}else{$("#add_product_buttons").hide();$("#product_add_form").hide();$("#img_upload_button").show();product_id=parseInt(a);click_image_upload()}}function add_response_error(a){try{show_form_errors(parseInt(a))}catch(b){_sys_error("product/add.js::add_response_error","geting error number",b)}}function click_image_upload(){if(!ImageUploader.check_exts()){hide_form_errors();show_form_errors(2);$("#img_upload_button").show()}else{upload_product_img_file()}}function upload_product_img_file(){$("#img_upload_label").hide();$("#img_upload_wait").show();$($("#img_upload_form").children("input[@name=pid]")).val(product_id);ImageUploader.on_upload_success=image_upload_success;ImageUploader.on_upload_error=image_upload_error;ImageUploader.upload()}function image_upload_error(a){$("#img_upload_wait").hide();$("#img_upload_label").show();hide_form_errors();show_form_errors(0,a)}function image_upload_success(){get_product_list()};
