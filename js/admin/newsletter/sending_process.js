var is_init=false;var is_pause=false;var text_color="";var bg_image="";var progressbar_line_bg="";var pause_text_color="";var pause_bg_image="";var pause_progressbar_line_bg="";function _pb_initialize(){try{pause_text_color=$("#pause_text_color").css("color");pause_bg_image=$("#pause_bg_progress_img").css("background-image");pause_progressbar_line_bg=$("#pause_progressbar_line_bg").css("background-color")}catch(a){_sys_error("sending_process:_pb_initialize","Getting progressbar attributes of img,bg-color and text color from div tags",a)}}function _set_pb_type(a){try{if(a=="pause"){var b=pause_text_color;var f=pause_bg_image;var c=pause_progressbar_line_bg}else{var b=text_color;var f=bg_image;var c=progressbar_line_bg}$("#start_percent").css("color",b);$("#current_percent").css("color",b);$("#end_percent").css("color",b);$("#bg_progress_id").css("background-image",f);$("#progressbar_line").css("background-color",c)}catch(d){_sys_error("sending_process:_set_pb_type","Changes progressbar display type - slider or pause",d)}}function _change_progressbar(a){try{if(parseInt(all_emails4sending)>0){$("#letters_are_sent").html(sent_emails);sent_emails+=parseInt(a);sent_emails_percent=parseInt(sent_emails*100/all_emails4sending);$("#current_percent").html(sent_emails_percent+"%");pbar_fullwidth=$("#bg_progress_id").width();pbar_curwidth=parseInt(sent_emails_percent*pbar_fullwidth/100);$("#progressbar_line").animate({width:pbar_curwidth+";"},200)}}catch(b){_sys_error("sending_process:_change_progressbar","Moves the slider of  progressbar",b)}}function destroy_process(a){try{msg=a;after_panel_load=after_panel_loaded;is_init=false;is_pause=false;text_color="";bg_image="";progressbar_line_bg="";pause_text_color="";pause_bg_image="";pause_progressbar_line_bg="";on_post_success=null;on_post_error=null;email_id=0;email_count=0;user_cat_list={};product_group_list={};product_list={};all_emails4sending=0;sent_emails=0;load_panel(base_url+"newsletter/subscribe");return}catch(b){_sys_error("sending_process:destroy_process","Sets all progressbar variables to initial values and return to step 1 page",b)}}function after_sending_start_success(b){try{if(sent_emails<all_emails4sending){_change_progressbar(b);if(is_pause){return false}on_post_success=after_sending_start_success;on_post_error=after_sending_start_error;start_request(base_url+"newsletter/send_step");return true}destroy_process("All emails were sent successfully")}catch(a){_sys_error("sending_process:after_send_start_success","Changes progressbar attributes",a)}}function after_sending_start_error(a){if(a!=""){_error_panel_show(a)}}function sending_start(){try{if(!is_init){_pb_initialize()}is_pause=false;if(all_emails4sending<1){all_emails4sending=$("#all_emails4sending").text()}$("#pb_slider_btn").css("display","none");$("#pb_pause_btn").css("display","block");_set_pb_type("slider");on_post_success=after_sending_start_success;on_post_error=after_sending_start_error;start_request(base_url+"newsletter/send_step")}catch(a){_sys_error("sending_process:sending_start","Changes progressbar start button to pause image and starts email sending process",a)}}function sending_pause(){try{is_pause=true;$("#pb_pause_btn").css("display","none");$("#pb_slider_btn").css("display","block");_set_pb_type("pause")}catch(a){_sys_error("sending_process:sending_pause","Stops sending process and changes progress bar display attributes",a)}return};
